<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"sharp-rookie.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

<script> 
   (function(){
          if(''){
              if (prompt('请输入文章密码') !== ''){
                  alert('密码错误！');
                  history.back();
              }
          }
      })();
  </script>
  <meta name="description" content="调研目录 Performance Analysis of a Token Bucket Shaper for MPEG4 Video and Real Audio Signal Cooperative Fair Bandwidth Scaling in Contention-based Wireless Networks using Time Token Bucket Token Bucket B">
<meta property="og:type" content="article">
<meta property="og:title" content="Token Bucket的应用调研">
<meta property="og:url" content="https://sharp-rookie.github.io/2022/02/13/%E3%80%90%E8%AE%BA%E6%96%87%E3%80%91Token%20Bucket%E7%9A%84%E5%BA%94%E7%94%A8/index.html">
<meta property="og:site_name" content="最忆是江南">
<meta property="og:description" content="调研目录 Performance Analysis of a Token Bucket Shaper for MPEG4 Video and Real Audio Signal Cooperative Fair Bandwidth Scaling in Contention-based Wireless Networks using Time Token Bucket Token Bucket B">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213101527.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213101528.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213085610.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213085703.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213085730.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213085802.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213091947.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213093357.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213093515.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213093853.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213104328.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213105742.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213105138.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213105224.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110008.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110106.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110118.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110300.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110642.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110736.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110720.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213142952.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143016.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143321.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143346.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143403.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143426.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143444.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143507.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143526.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143546.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143602.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143628.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143649.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143717.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143801.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143818.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143835.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213200743.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213200814.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213200853.png">
<meta property="og:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213200907.png">
<meta property="article:published_time" content="2022-02-13T02:09:13.982Z">
<meta property="article:modified_time" content="2022-02-20T01:40:24.269Z">
<meta property="article:author" content="Lrk612">
<meta property="article:tag" content="5G">
<meta property="article:tag" content="Resource Management">
<meta property="article:tag" content="Token Bucket">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/lrk612/md_picture/raw/master/img/20220213101527.png">

<link rel="canonical" href="https://sharp-rookie.github.io/2022/02/13/%E3%80%90%E8%AE%BA%E6%96%87%E3%80%91Token%20Bucket%E7%9A%84%E5%BA%94%E7%94%A8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Token Bucket的应用调研 | 最忆是江南</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
        <a target="_blank" rel="noopener" href="https://github.com/Sharp-rookie" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">最忆是江南</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Love actually is all around</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th-list fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-friendlink">

    <a href="/friendlink/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-download fa-fw"></i>资源</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sharp-rookie.github.io/2022/02/13/%E3%80%90%E8%AE%BA%E6%96%87%E3%80%91Token%20Bucket%E7%9A%84%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Lrk612">
      <meta itemprop="description" content="Lrk's blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="最忆是江南">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Token Bucket的应用调研
        </h1>

        <div class="post-meta">
         
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-13 10:09:13" itemprop="dateCreated datePublished" datetime="2022-02-13T10:09:13+08:00">2022-02-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/" itemprop="url" rel="index"><span itemprop="name">论文阅读</span></a>
                </span>
            </span>

          
            <span id="/2022/02/13/%E3%80%90%E8%AE%BA%E6%96%87%E3%80%91Token%20Bucket%E7%9A%84%E5%BA%94%E7%94%A8/" class="post-meta-item leancloud_visitors" data-flag-title="Token Bucket的应用调研" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/02/13/%E3%80%90%E8%AE%BA%E6%96%87%E3%80%91Token%20Bucket%E7%9A%84%E5%BA%94%E7%94%A8/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/02/13/%E3%80%90%E8%AE%BA%E6%96%87%E3%80%91Token%20Bucket%E7%9A%84%E5%BA%94%E7%94%A8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="调研目录"><a href="#调研目录" class="headerlink" title="调研目录"></a>调研目录</h2><ul>
<li>Performance Analysis of a Token Bucket Shaper for MPEG4 Video and Real Audio Signal</li>
<li>Cooperative Fair Bandwidth Scaling in Contention-based Wireless Networks using Time Token Bucket</li>
<li>Token Bucket Based Traffic Shaping and Monitoring for WLAN-based Control Systems</li>
<li>Dynamic Token Bucket (DTB): A Fair Bandwidth Allocation Algorithm for High-speed Networks</li>
</ul>
<span id="more"></span>

<p>&nbsp;</p>
<h2 id="论文一"><a href="#论文一" class="headerlink" title="论文一"></a>论文一</h2><blockquote>
<p>原文：<a target="_blank" rel="noopener" href="https://lrk612.com/resources/Performance%20analysis%20of%20a%20Token%20Bucket%20Shaper%20for%20MPEG4%20video%20and%20Real%20Audio%20signal.pdf">Performance Analysis of a Token Bucket Shaper for MPEG4 Video and Real Audio Signal</a> </p>
<p>应用：</p>
<p>&emsp;&emsp;设计了Token Bucket整形器，改变发送流量的时间特征，对突发和随机数据进行整形，向网络提交符合要求的数据包，以提供QoS保证</p>
<p>背景：</p>
<p>&emsp;&emsp;流量整形处理使数据符合带宽，而流量监管用于检查数据是否符合网络参数。流量整形在用户端进行，流量监管在网络端进行，以确保用户没有违反服务水平协议。流量整形非常重要，因为它可以确保在网络端不会因为流量监管而丢弃任何数据包</p>
<p>内容：</p>
<ul>
<li>介绍了令牌桶整形器对真实世界数据（如 MPEG4 视频和真实音频信号）的性能分析</li>
<li>讨论了不同 Token Bucket Shaper 参数对其性能的影响</li>
</ul>
<p>对比论文：<a target="_blank" rel="noopener" href="https://lrk612.com/resources/Correlated%20token%20bucket%20shapers%20for%20multiple%20traffic%20classes.pdf">Correlated token bucket shapers for multiple traffic classes</a></p>
</blockquote>
<h3 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h3><p>&emsp;&emsp;文中使用的方法基于对每个流量类别使用多个独立令牌桶整形器。这种令牌桶整形器的优点是与多个相关的令牌桶整形器相比，其实现要简单得多。每个令牌桶整形器都有自己的流量生成器、令牌桶和数据包队列。用户能够改变桶大小、队列长度和令牌生成率的值。从用户端发送的MPEG4视频和真实音频信号数据由各自的令牌桶整形器独立整形。仅当令牌桶中存在足够的令牌时，数据才会发送到网络。一个桶中存在令牌不会对另一个流量类别的性能产生任何影响。</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213101527.png" alt="image-20220211163734069" style="zoom: 67%;" />

<p>&nbsp;</p>
<hr>
<p>&nbsp;</p>
<h2 id="论文二"><a href="#论文二" class="headerlink" title="论文二"></a>论文二</h2><blockquote>
<p>原文：<a target="_blank" rel="noopener" href="https://lrk612.com/resources/Cooperative%20Fair%20Bandwidth%20Scaling%20in%20Contention-based%20Wireless%20Networks%20using%20Time%20Token%20Bucket.pdf">Cooperative Fair Bandwidth Scaling in Contention-based Wireless Networks using Time Token Bucket</a></p>
<p>应用：</p>
<p>&emsp;&emsp;提出了一种使用时间令牌桶方法进行动态协作带宽缩放的协作算法，以公平的方式提高了带宽利用率，动态响应拓扑变化，实现了参与节点的稳定带宽使用</p>
<p>背景：</p>
<p>&emsp;&emsp;IEEE 802.11 (WiFi) 等当今现成的无线标准不能很好地支持具有服务质量 (QoS) 要求的应用。指定一系列最低要求的基本 QoS 和首选 QoS，并在此范围内结合动态扩展会有助于支持 QoS，同时提高网络利用率。但是扩展通常以贪婪且不公平的方式发生，每个节点都试图最大化其吞吐量</p>
<p>内容：</p>
<p>&emsp;&emsp;文章首先定义了节点间的公平性，然后利用时间令牌桶算法分配带宽资源，又定义了节点等级 level，通过放缩 level 来改变节点的可分配资源量，从而实现整体公平的频谱资源调度策略</p>
<p>参考论文：<a target="_blank" rel="noopener" href="https://lrk612.com/resources/Token%20Bucket%20Based%20Traffic%20Shaping%20and%20Monitoring%20for%20WLAN-based%20Control%20Systems.pdf">Token Bucket Based Traffic Shaping and Monitoring for WLAN-based Control Systems</a>（见下面）</p>
</blockquote>
<h3 id="模型-1"><a href="#模型-1" class="headerlink" title="模型"></a>模型</h3><h4 id="QoS-公平性"><a href="#QoS-公平性" class="headerlink" title="QoS 公平性"></a>QoS 公平性</h4><p>文章不仅仅是以公平的方式扩展带宽使用，同时还是为了支持带宽需求。这意味着对公平的定义不仅仅是每个节点应该获得大约相同的带宽。相反，文章首先要求每个节点至少应该获得足够的带宽来满足其基本带宽要求。然后，扩展带宽应该在基本和首选带宽要求之间以公平的方式发生。</p>
<p>为了形式化对公平性的定义，首先定义节点 v 的带宽需求如下：</p>
<ul>
<li>requestBwBase ∈ [0, 1]，节点v的相对基本带宽</li>
<li>requestBwPref ∈ [0, 1]，节点v的相对首选带宽</li>
</ul>
<p>假设每个节点上的应用程序都有可以派生对以上值的要求。比如，应用程序可能必须每秒发送大小在 <code>base</code> 和 <code>preferred</code> 帧之间的帧。若数据速率为 <code>rate</code>，则有：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213101528.png" alt="image-20220213085320943" style="zoom:60%;" />

<p>假设所有节点都使用其基本带宽进行传输是可能的。在单跳网络中，这意味着所有节点 V 的相对请求带宽之和不得超过 1：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213085610.png" alt="image-20220213085610396" style="zoom:60%;" />

<p>缩放应该发生在基本和首选带宽的范围内，即：动态带宽控制将带宽 <code>asignedBw</code> 分配给下面范围内的每个节点 v：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213085703.png" alt="image-20220213085703255" style="zoom:60%;" />

<p>定义带宽的相对分配比例 <code>extraBw</code> 如下：：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213085730.png" alt="image-20220213085730345" style="zoom:60%;" />

<p>由此可知，分配了基本带宽的节点的 <code>extraBw</code> = 0，而分配了首选带宽的节点的 <code>extraBw</code> = 1</p>
<p>接下来根据 [15] 中的公平指数概念，定义节点 v 之间带宽分配的 QoS 公平性。由于节点之间的绝对带宽相等并不是公平，分配比例<code>extraBwv</code> 的相等才是，所以公平指数通过 <code>extraBwv</code> 计算，而不是 <code>assignBw</code>：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213085802.png" alt="image-20220213085802475" style="zoom:60%;" />

<p>如果所有节点具有相同的 <code>extraBw</code>，则此公平指数为 1。特别地，如果所有节点都只分配了它们的基本带宽，则公平指数也为 1。但是这意味着所有节点的 <code>extraBw</code> = 0，此时分母为0。公平指数概念有一个缺点，即：可能发生所有节点的 <code>assignBw</code> = 0的情况，例如连接断开时。因此，文章假设 ∑|V | v=1 extraBwv2 = 0 的情况为完全公平，即公平指数为 1。不希望将更多带宽分配给没有完全使用它们已经分配的节点。因此认为这些节点是公平对待的，并且仅在分配时会使用更多带宽的节点之间计算公平指数。</p>
<h4 id="时间-Token-Bucket-算法"><a href="#时间-Token-Bucket-算法" class="headerlink" title="时间 Token Bucket 算法"></a>时间 Token Bucket 算法</h4><p>使用时间令牌桶算法 [14] 进行流量整形，即将节点 v 可以使用的带宽限制为 <code>assignmentBw</code>。如果节点 v 尝试使用超过 <code>assignmentBw</code>，令牌桶机制会延迟（或丢弃）帧。</p>
<p>文章中的时间令牌桶机制与标准令牌桶机制的工作原理类似：固定大小的令牌不断落入桶中，如下图所示。桶具有最大容量，如果桶满则令牌溢出。发送帧时，节点需要桶中有足够的令牌。这意味着帧可能会在帧到达队列中延迟，直到有足够的令牌放入桶中。</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213091947.png" alt="image-20220213091947148" style="zoom:60%;" />

<p>时间令牌桶与标准令牌桶算法的区别在于令牌代表什么的定义：在标准令牌桶算法中，令牌代表发送一定大小数据的权利。例如：令牌大小为 100 B，发送 1000 B 的帧将需要 10 个令牌。由于 IEEE 802.11 规定了不同的数据速率，发送 1000 B 可能需要 以 1 MB/s 发送 8 ms ，或 600 MB/s 发送 13 μs。因此如果使用标准令牌桶算法反而会导致允许慢速节点比快速节点使用介质更长的时间。而本场景希望以公平的方式共享介质使用时间，而不是传输数据，因此本文时间令牌桶中的一个令牌代表了在一个小时间片内使用介质的权利。发送帧时，必须收集足够的令牌才能以选定的数据速率传输帧。此外，MAC 层开销的时间，例如 IEEE 802.11 中所需的帧间空间，将被视为传输帧所需的时间。如果该帧是单播帧，并且很可能随后传输确认帧，则单播帧的发送者还必须收集发送确认帧所需的令牌。这意味着可以无延迟地发送确认帧，并且会消耗分配给发送方而不是接收方的带宽。</p>
<p>正如 [14] 中所解释的，令牌桶机制还允许派生一个称为 <em>不可用浪费带宽比</em> 的度量。它本质上测量节点尝试使用但由于介质繁忙而无法使用的带宽。在介质繁忙的情况下，帧被卡在帧发送队列中，而令牌桶慢慢填满并溢出。在这种情况下计算溢出的令牌，可以计算出不可用的浪费带宽。此外，如果存储桶溢出但队列为空，则会发生可用带宽浪费。通过计算溢出令牌的数量，可以计算分配但未使用的带宽量。</p>
<h4 id="带宽缩放"><a href="#带宽缩放" class="headerlink" title="带宽缩放"></a>带宽缩放</h4><p>为了在基本带宽和首选带宽之间进行缩放，分配的带宽 <code>assignmentBw</code> 会动态变化。在时间令牌桶中，通过相应地更改重新填充间隔来实现这一点。</p>
<p>首先将 <code>requestBwBase</code> 和 <code>requestBwPref</code> 之间的间隔拆分为等距离的级别。每个节点 v 根据其当前级别 <code>levelv</code> 计算其分配的带宽，如下所示：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213093357.png" alt="image-20220213093357846" style="zoom:60%;" />

<p>将 <code>extraBw</code> 表达式带入得：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213093515.png" alt="image-20220213093515180" style="zoom:60%;" />

<center>levels 代表level的最大值</center>

<p>很明显，随着 <code>levelv</code> 的增加 <code>extraBw</code> 会线性扩展。从 <code>levelv</code> = 0 开始，节点获得分配的基本带宽，即 extraBwv = 0；<code>levelv</code> 达到最大值时，节点分配得到其首选带宽，即extraBwv = 1。根据公平性定义，这意味着当所有节点处于同一级别时，相当于实现了完美的公平性。</p>
<p>为了使用时间令牌桶机制调整带宽使用，重新填充间隔是动态更改的。可以使用上面公式中的 <code>assignedBw</code> 推导出来，配置 <code>tokenSize</code> 如下：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213093853.png" alt="image-20220213093853483" style="zoom:60%;" />



<h4 id="带宽缩放的条件"><a href="#带宽缩放的条件" class="headerlink" title="带宽缩放的条件"></a>带宽缩放的条件</h4><p>上面展示了如何根据级别扩展节点使用的带宽，接下来解释节点放大或缩小时的条件，即增加或减少其 <code>level</code>。</p>
<p>最初，每个节点从 <code>levelv</code> = 0 开始，即在其请求的基本带宽处。在常规控制间隔内，例如一秒，节点 v 都会检查它是否应该增加或减少其级别。</p>
<h5 id="上调条件"><a href="#上调条件" class="headerlink" title="上调条件"></a>上调条件</h5><p>如果满足以下所有条件，它将增加 1 级：</p>
<table>
<thead>
<tr>
<th>条件</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>level</code> 未达到最大值，即 <code>levelv</code> &lt; <code>levels</code></td>
<td>确保不超过首选带宽</td>
</tr>
<tr>
<td>不存在较低 <code>level</code> 的相邻节点</td>
<td>强制节点之间的公平性：一个节点需要等待它的邻居扩展到它当前使用的相同级别，然后才能被允许进一步扩展。</td>
</tr>
<tr>
<td>节点在最后一个控制间隔内完全使用了其分配的带宽</td>
<td>确保不存在因为介质过载而无法完全使用其当前分配的带宽；确保带宽资源不浪费</td>
</tr>
<tr>
<td>没有相邻节点因介质过载而无法完全使用其当前分配的带宽</td>
<td>强制节点之间的公平性：相邻节点实际可以用带宽不能差太多</td>
</tr>
<tr>
<td>没有在至少 <code>10 + random(0, 9)</code> 个控制间隔内增加其 <code>level</code></td>
<td>确保节点不会扩展得太快</td>
</tr>
</tbody></table>
<h5 id="下调条件"><a href="#下调条件" class="headerlink" title="下调条件"></a>下调条件</h5><p>如果满足以下所有条件，它将降低 1 级：</p>
<table>
<thead>
<tr>
<th>条件</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>level</code> &gt; 0</td>
<td>——</td>
</tr>
<tr>
<td>存在 level 比自己低2或以上的相邻节点，并其所有带宽都充分使用</td>
<td>强制节点之间的公平性</td>
</tr>
<tr>
<td>节点在最后一个控制间隔内没有完全使用其分配的带宽</td>
<td>因为介质过载而无法完全使用其当前分配的带宽；或者是造成了带宽资源的浪费</td>
</tr>
<tr>
<td>有相邻节点表示不能完全使用其分配的带宽</td>
<td>强制节点之间的公平性：相邻节点实际可以用带宽不能差太多</td>
</tr>
</tbody></table>
<p>对于缩减条件 2和 3，文章为节点由于介质争用而无法使用的带宽量设置了上限阈值，即 <em>不可用的浪费带宽比率</em>，例如最多 5% 的分配带宽可能无法使用。</p>
<p>总而言之，扩展条件确保节点以公平的方式扩展，并且尽可能优化整体吞吐量。</p>
<p>&nbsp;</p>
<hr>
<p>&nbsp;</p>
<h2 id="论文三"><a href="#论文三" class="headerlink" title="论文三"></a>论文三</h2><blockquote>
<p>原文：<a target="_blank" rel="noopener" href="https://lrk612.com/resources/Token%20Bucket%20Based%20Traffic%20Shaping%20and%20Monitoring%20for%20WLAN-based%20Control%20Systems.pdf">Token Bucket Based Traffic Shaping and Monitoring for WLAN-based Control Systems</a></p>
<p>应用：</p>
<p>&emsp;&emsp;提出了一种应用令牌桶算法变体的流量整形方法，以及一种流量监控方法，以确定网络过载；引入并应用了不可用浪费带宽比，该指标源自不可用的浪费令牌的数量，用于检测本地网络过载</p>
<p>背景：</p>
<p>&emsp;&emsp;为了监测和控制工业环境中的生产过程，无线网络控制系统 (WNCS)用于灵活且经济的方式连接传感器、执行器和控制器，甚至可以支持移动对象。WNCS 的控制应用程序通常具有关于带宽、传输延迟和帧丢失率的服务质量 (QoS) 要求。一种基于反馈的闭环控制方法能够提供足够的QoS保证，但是这需要合适的流量监控方法，即感知当前网络负载和流量整形，例如延迟或丢弃帧。</p>
<p>内容：</p>
<p>&emsp;&emsp;文章首先对节点预留带宽进行规划，然后使用时间令牌桶模型对资源调度进行建模，给出了令牌通道各项参数指标。</p>
</blockquote>
<h3 id="模型-2"><a href="#模型-2" class="headerlink" title="模型"></a>模型</h3><h4 id="带宽预留"><a href="#带宽预留" class="headerlink" title="带宽预留"></a>带宽预留</h4><p>带宽预留由集中式带宽管理器 (CBM) 动态执行。除了分散式方法之外，该解决方案还可以精确控制分配的带宽。文章中，术语带宽表示允许节点使用介质进行传输的最大时间量或最大介质占用持续时间。为了有效地运行网络，文章只使用了无线网络 G 的总带宽的一定比例 <code>bwr_G_assgn</code> ∈ [0,1]，例如20%。选择该比率一是为了使介质争用保持足够小，二是取决于外部流量的影响。类似地，<code>bwr_v_avail</code> ∈ [0,1] 表示节点 v 的可用本地带宽。</p>
<p>假设每个节点 v ∈ Vi 有一个相对带宽要求 <code>bwr_v_required</code> ∈ [0,1]，从 CBM 请求。基于 <code>bwr_G_avail</code> 和当前分配的相对带宽 <code>bwr_G_assgn</code>，CBM 决定是否可以批准请求。如果批准，CBM 将 <code>bwr_v_required</code> 作为 <code>bwr_v_assgn</code> 返回，否则返回 0。更具体地说，CBM 必须强制执行以下约束：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213104328.png" alt="image-20220213104328033" style="zoom:40%;" />

<p>在多跳网络中，带宽预留建立在用于自动链路检测的协议之上，提供用于路由目的的拓扑信息。</p>
<h4 id="流量整形"><a href="#流量整形" class="headerlink" title="流量整形"></a>流量整形</h4><p>流量整形的目的是监控节点v的本地带宽使用 <code>bwr_v_used</code> 是否符合分配的相对带宽 <code>bwr_v_assgn</code>，延迟或丢弃超过它的帧，并均匀分配流量以避免全局峰值和高争用情况</p>
<p>文章为流量整形设计了一种改进的令牌桶算法（图1）。与原始令牌桶算法一样，令牌以恒定的重新填充间隔放入桶中。在原始令牌桶算法中，每个令牌代表发送一定字节数的权利。在 WLAN 上，可以以许多不同的传输速率发送帧，因此传输一定数量字节的时间可能会有很大差异。考虑到这一点，文章使用等长的时间片作为标记。每个时间片代表对介质的短期访问权。为了调度帧进行传输，必须在桶中收集足以覆盖帧传输时间（包括开销）的令牌。当帧从到达队列移动到发送队列时，这些令牌会从存储桶中删除。当桶已经被填满时，进一步的重新填充尝试会导致溢出，即令牌丢失。</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213105742.png" alt="image-20220213105742432" style="zoom:40%;" />

<center>图 1</center>

<p>节点 v ∈ V i 的令牌桶由带宽配置文件 bpv 表征。要确定 bpv，除了 <code>bwr_v_required</code> 之外，CBM 还需要最大有效负载大小。节点 v 的带宽配置文件是一个元组 bpv：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213105138.png" alt="image-20220213105138694" style="zoom:40%;" />

<p>其中：</p>
<ul>
<li><p><code>d_v_txMax</code> ∈ N0 [μs] 是节点 v 的最大介质占用持续时间或最大突发大小。为了最小化可能的突发并保证可以发送所有帧，文章将其设置为以最低传输速率传输最大可能帧所需的持续时间：</p>
  <img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213105224.png" alt="image-20220213105224270" style="zoom:40%;" />

<p>  其中，<code>bMLO</code> 表示 MAC 层开销（以字节为单位），dPLO 是 PHY 层开销的平均值（以微秒为单位），包括帧间距、平均退避间隔和 PHY 前导码。</p>
</li>
<li><p><code>d_v_refill</code> ∈ N0 [μs] 是在节点 v 的桶中收集的介质占用持续时间增加的再填充间隔。作为启发式，重新填充间隔应该足够小以避免不必要的延迟，平均每帧半个令牌。</p>
</li>
<li><p><code>bwr_v_assgn</code> ∈ [0,1]：<code>bwr_v_requested</code>，如果被批准；否则为 0。它是分配给节点 v 的带宽相对于网络带宽。</p>
</li>
</ul>
<p>与通用令牌桶 [4] 相比，<code>d_v_txMax</code> 和 <code>d_v_refill</code> 分别表示桶大小和令牌重新填充间隔。从 bpv 可以确定节点 v 的进一步桶参数如下：</p>
<ul>
<li><p><code>d_v_token</code> [μs] 表示令牌的大小：</p>
  <img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110008.png" alt="image-20220213110008829" style="zoom:40%;" /></li>
<li><p><code>n_v_fillings</code> 表示完全填充桶所需的令牌总数：</p>
  <img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110106.png" alt="image-20220213110106057" style="zoom:40%;" /></li>
<li><p><code>d_v_bucket</code> [μs] 表示完全填满空桶所需的最短时间：</p>
  <img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110118.png" alt="image-20220213110118919" style="zoom:40%;" /></li>
</ul>
<p>接下来，文章讨论了一个根据应用需求计算桶参数的例子。考虑在节点 v 上运行的周期性应用程序 appX，其值如下：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110300.png" alt="image-20220213110300487" style="zoom:40%;" />

<p>其中：</p>
<ul>
<li>b_appX_ payload ∈N0 是以字节为单位的有效载荷大小</li>
<li>d_appX_ period ∈N0 [μs] 是应用周期长度</li>
<li>n_appX_msg ∈ N0 是周期性应用程序在一个周期内发送的消息数</li>
</ul>
<p>代入上面公式可得：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110642.png" style="zoom:40%;" />

<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110736.png" alt="image-20220213110736058" style="zoom:40%;" />

<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213110720.png" alt="image-20220213110720737" style="zoom:40%;" />

<p>图 1 说明了改进的令牌桶算法的操作。要发送的帧被放入帧到达队列中。如果桶已满且帧发送队列为空，则可以安排下一帧进行传输，方法是将其放入发送队列并从桶中消耗所需数量的令牌。如果桶中没有足够的令牌或者帧发送队列仍然包含一个帧，那么下一帧会被延迟，直到两个条件都成立。令牌被放入存储桶中，由重新填充间隔确定。</p>
<p>请注意，通过将帧发送队列的大小限制为 1 并通过保持桶大小保持较小，可以限制传输突发。当一个帧被调度传输时，下一帧被延迟。因此，节点v的使用带宽比 <code>bwr_v_used</code> 被限制为 <code>bwr_v_assgn</code>。</p>
<h4 id="流量监测"><a href="#流量监测" class="headerlink" title="流量监测"></a>流量监测</h4><p>通过监控令牌桶来进行流量监控。当分配的带宽未被利用时，令牌桶会溢出，导致令牌浪费。这可能有两个原因：</p>
<ol>
<li>分配的带宽超过使用的带宽，即 <code>bwr_v_assgn</code> ≥ <code>bwr_v_used</code>。这里浪费的令牌称为<em>可用的浪费令牌</em>，因为应用程序可以使用它们，只是不需要</li>
<li>网络过载，即 <code>bwr_v_assgn</code> ≥ <code>bwr__vavail</code>。由于高竞争，帧在发送队列中停留的时间更长，因此到达队列中的帧不能使用重新填充的令牌，从而导致溢出。这样无法使用的token称为<em>不可用的浪费令牌</em>，因为过多的介质争用而无法使用它们。</li>
</ol>
<p>为了监控可用和不可用的浪费令牌，文章引入了两个计数器：</p>
<ol>
<li>计数器 <code>n_v_WT_usable(t)</code> 表示在时间 t 之前浪费的<em>可用令牌</em>。如果令牌桶已满，且帧发送队列和帧到达队列均为空时，则在生成令牌时递增</li>
<li>计数器 <code>nv_WT_unusable(t)</code> 表示在时间 t 之前浪费的<em>不可用令牌</em>。如果令牌桶已满，且帧发送队列或帧到达队列不为空，则在生成令牌时递增</li>
</ol>
<p>使用这些计数器并基于监控的传输活动，可以得出以下特征参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
<th>公式</th>
</tr>
</thead>
<tbody><tr>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213142952.png" alt="image-20220213142952535" style="zoom:50%;" /></td>
<td>从实验开始到时间 t，节点 v 使用介质传输帧的总时间</td>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143016.png" alt="image-20220213143016580" style="zoom:40%;" /></td>
</tr>
<tr>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143321.png" alt="image-20220213143321820" style="zoom:50%;" /></td>
<td>从节点开始时间到时间 t，节点 v 使用的分配带宽的比率。</td>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143346.png" alt="image-20220213143346594" style="zoom:40%;" /></td>
</tr>
<tr>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143403.png" alt="image-20220213143403387" style="zoom:50%;" /></td>
<td>自开始以来，节点 v 在时间 t 的不可用浪费分配带宽的比率</td>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143426.png" alt="image-20220213143426615" style="zoom:40%;" /></td>
</tr>
<tr>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143444.png" alt="image-20220213143444428" style="zoom:50%;" /></td>
<td>自开始以来节点 v 在时间 t 的可用浪费分配带宽的比率</td>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143507.png" alt="image-20220213143507229" style="zoom:40%;" /></td>
</tr>
<tr>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143526.png" alt="image-20220213143526909" style="zoom:50%;" /></td>
<td>自开始以来，节点 v 在时间 t 浪费的分配带宽的比率</td>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143546.png" alt="image-20220213143546280" style="zoom:40%;" /></td>
</tr>
<tr>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143602.png" alt="image-20220213143602603" style="zoom:50%;" /></td>
<td>在时间 t 来自节点 v 的硬件寄存器的值 Channel Busy Time (CBT)</td>
<td></td>
</tr>
<tr>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143628.png" alt="image-20220213143628603" style="zoom:50%;" /></td>
<td>从开始到时间 t，节点 v 观察到介质繁忙的时间比率</td>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143649.png" alt="image-20220213143649739" style="zoom:40%;" /></td>
</tr>
<tr>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143717.png" alt="image-20220213143717099" style="zoom:50%;" /></td>
<td>节点v感知介质能量的时间量，不包括从开始到时间 t 的传输持续时间</td>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143801.png" alt="image-20220213143801843" style="zoom:40%;" /></td>
</tr>
<tr>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143818.png" alt="image-20220213143818871" style="zoom:50%;" /></td>
<td>从开始到时间 t，节点感知介质能量（不包括其传输持续时间）的时间比率</td>
<td><img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213143835.png" alt="image-20220213143835843" style="zoom: 40%;" /></td>
</tr>
</tbody></table>
<p>注：第一行 Fv(t) 表示节点 v 在时间 t 之前发送的帧，b_f_payload 表示单个帧的有效载荷大小，r_f_tx 表示发送它的速率</p>
<p>&nbsp;</p>
<hr>
<p>&nbsp;</p>
<h2 id="论文四"><a href="#论文四" class="headerlink" title="论文四"></a>论文四</h2><blockquote>
<p>原文：<a target="_blank" rel="noopener" href="https://lrk612.com/resources/Dynamic%20token%20bucket%20DTB%20a%20fair%20bandwidth%20allocation_algorithm%20for%20high-speed%20networks.pdf">Dynamic Token Bucket (DTB): A Fair Bandwidth Allocation Algorithm for High-speed Networks</a></p>
<p>应用：</p>
<p>&emsp;&emsp;提出了一种基于令牌桶监管的计算简单机制，以实现一组竞争流的几乎相等的带宽分配。可以动态调整令牌桶阈值并测量流的瞬时到达率。此框架可用于基于 Internet 和帧中继的虚拟专用网络 (VPN)。</p>
<p>背景：</p>
<p>&emsp;&emsp;FIFO 调度在公平带宽分配方面表现不佳；使用拥塞控制的 TCP 等协议也无法避免 FIFO 调度中固有的不公平性。路由器中的智能调度能够缓解公平性问题，但是这意味着维护每个流的信息并执行每个流的计算，复杂度太高。</p>
<p>内容：</p>
<p>&emsp;&emsp;在令牌桶的基础上，观测每个类型数据流对应令牌桶的活跃状态、数据总量和数据包到达率，然后根据每个bucket的流量情况引入概率丢包机制来削弱行为不端的类型</p>
</blockquote>
<h3 id="模型-3"><a href="#模型-3" class="headerlink" title="模型"></a>模型</h3><p>&emsp;&emsp;令牌桶流量整形是通过维护一个计数器来计算令牌和一个计时器来确定何时向计数器添加新令牌来实施的。当长度为 1（字节）的数据包到达缓冲区并且计数器中至少有 1 个令牌时，发送数据包并从计数器中删除 1 个令牌。如果令牌桶中的令牌少于 1，则数据包必须等待令牌滴入桶中，直到至少有 1 个令牌，此时才发送。令牌桶以每 T 秒 RT 个令牌的有效速率补充。令牌桶的优点是它的简单性和对典型的数据流量有限突发性的适应能力。T 的选择有一个权衡，较高的 T 值允许更好的突发性能，而较小的 T 值有助于防止流在非常小的时间间隔内发送大突发。每 T 秒重置一次的计时器会触发令牌桶的重新初始化。</p>
<p>&emsp;&emsp;本文 DTB 模型基于令牌桶算法并进行了一些修改。在 DTB 中，每个活动流都分配有一个令牌桶。令牌桶的容量等于瞬时公平率 F(t)。公平率取决于活动流的数量 N(t) 和链路容量 C：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213200743.png" alt="image-20220213200743183" style="zoom:40%;" />

<p>对于以 <code>fi</code> 为索引的每个流，DTB 在路由器中维护以下变量：</p>
<ol>
<li><code>arrivals_i</code>：自上次补充令牌桶以来到达缓冲区的 <code>fi</code> 流的字节数</li>
<li><code>admitted_i</code>：自上次填充桶以来进入缓冲区的 <code>fi</code> 流的字节数</li>
<li><code>active_i</code>：一个布尔变量，指示流是否处于活动状态</li>
</ol>
<p>当一个流在定时器复位后发送它的第一个数据包时，它就被声明为活动的。如果在两次连续定时器重置之间的时间间隔内没有发送数据包，则活动流被声明为非活动流。</p>
<p>&emsp;&emsp;作为上述每个流状态变量的一部分，DTB 还维护了全局变量 <code>F(t)</code> 和 <code>N(t)</code>。将 MAXFLOWS 定义为一个常数，等于任何链路上支持的最大流数。对于 <code>fi</code> 的所有值，将 <code>active_i</code> 设置为零。当来自 <code>fi</code> 流的第一个数据包到达链路时，<code>active_i</code> 设置为 1 以指示该流处于活动状态。初始重置的 <code>N(t)</code> 增加 1，并计算并存储公平利率 <code>F(t)</code> 的相应值。此时，<code>arrivals_i</code> 和 <code>admitted_i</code> 设置为零，即初始化 <code>fi</code> 流的令牌桶。在初始化之后，每当属于 <code>fi</code> 流的数据包被允许进入缓冲区时，<code>admitted_i</code> 就会增加数据包的长度 <code>li</code> 。但是在时间 t 时，数据包被允许进入缓冲区的前提条件是：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213200814.png" alt="image-20220213200814745" style="zoom:40%;" />

<p>如果上式不成立，数据包立即被丢弃，不像基本的令牌桶方法，将它保存在缓冲区中，直到桶中有 <code>li</code> 个令牌后调度。这样做是为了避免按流缓冲开销，有利于简单的 FIFO 调度。就像在基本的令牌桶实现中一样，定时器每 T 秒关闭一次，此时所有活动流的 <code>admitted_i</code> 和 <code>arrivals_i</code> 都被清除。</p>
<p>在仿真实验中观察到单靠上面不等式无法实现公平：当多个流以不同的速率发送数据包时，可以观察到具有低传输速率的流实现了非常低的吞吐量（归一化为公平速率）。为了处理这个问题，文章为每个活动流定义了变量<code>arrivals_i</code>，在非活动流的第一个数据包到达缓冲区时初始化，并按相应流的每个到达数据包的长度递增。根据该变量值估计流的到达率，当一个属于 <code>fi</code> 流的数据包到达缓冲区并且有足够的令牌和缓冲区空间可用时，依概率决定是否接纳该数据包，如果（在时间 r）缓冲区级别高于预定义的阈值 <code>Cthresh</code> 并且有：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213200853.png" alt="image-20220213200853664" style="zoom:40%;" />

<p>其中 F(t) 是上面定义的瞬时公平率，Ri(t) 是到达率：</p>
<img src="https://gitee.com/lrk612/md_picture/raw/master/img/20220213200907.png" alt="image-20220213200907013" style="zoom:40%;" />

<center>这里还可以使用滑动平均、加权平均</center>

<p>其中 i 是计时器自上次到期以来的值。</p>
<p>选择 Clhresh 的值是为了通过概率性地丢弃行为不端流（以远高于公平速率传输的流）的数据包为弱流留出缓冲区空间。观察上面不等式，流到达率越大，数据包丢弃概率越大，从而帮助较弱的流有效地屏蔽了行为不端的流。</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Lrk612
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://sharp-rookie.github.io/2022/02/13/%E3%80%90%E8%AE%BA%E6%96%87%E3%80%91Token%20Bucket%E7%9A%84%E5%BA%94%E7%94%A8/" title="Token Bucket的应用调研">https://sharp-rookie.github.io/2022/02/13/【论文】Token Bucket的应用/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/5G/" rel="tag"># 5G</a>
              <a href="/tags/Resource-Management/" rel="tag"># Resource Management</a>
              <a href="/tags/Token-Bucket/" rel="tag"># Token Bucket</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/02/12/%E3%80%90%E8%AE%BA%E6%96%87%E3%80%91DRL&%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%AF%B9%E7%BD%91%E7%BB%9C%E4%B8%9A%E5%8A%A1%E5%88%86%E7%B1%BB/" rel="prev" title="DRL & 随机森林对网络业务分类">
      <i class="fa fa-chevron-left"></i> DRL & 随机森林对网络业务分类
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/02/13/%E3%80%90%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E3%80%91UNREAL%EF%BC%9A%E7%A3%A8%E5%88%80%E4%B8%8D%E8%AF%AF%E7%A0%8D%E6%9F%B4%E5%B7%A5/" rel="next" title="【强化学习】UNREAL：磨刀不误砍柴工">
      【强化学习】UNREAL：磨刀不误砍柴工 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E7%A0%94%E7%9B%AE%E5%BD%95"><span class="nav-text">调研目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BA%E6%96%87%E4%B8%80"><span class="nav-text">论文一</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B"><span class="nav-text">模型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BA%E6%96%87%E4%BA%8C"><span class="nav-text">论文二</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B-1"><span class="nav-text">模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#QoS-%E5%85%AC%E5%B9%B3%E6%80%A7"><span class="nav-text">QoS 公平性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%B6%E9%97%B4-Token-Bucket-%E7%AE%97%E6%B3%95"><span class="nav-text">时间 Token Bucket 算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%A6%E5%AE%BD%E7%BC%A9%E6%94%BE"><span class="nav-text">带宽缩放</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%A6%E5%AE%BD%E7%BC%A9%E6%94%BE%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="nav-text">带宽缩放的条件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8A%E8%B0%83%E6%9D%A1%E4%BB%B6"><span class="nav-text">上调条件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8B%E8%B0%83%E6%9D%A1%E4%BB%B6"><span class="nav-text">下调条件</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BA%E6%96%87%E4%B8%89"><span class="nav-text">论文三</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B-2"><span class="nav-text">模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%A6%E5%AE%BD%E9%A2%84%E7%95%99"><span class="nav-text">带宽预留</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E9%87%8F%E6%95%B4%E5%BD%A2"><span class="nav-text">流量整形</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E9%87%8F%E7%9B%91%E6%B5%8B"><span class="nav-text">流量监测</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BA%E6%96%87%E5%9B%9B"><span class="nav-text">论文四</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B-3"><span class="nav-text">模型</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Lrk612"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Lrk612</p>
  <div class="site-description" itemprop="description">Lrk's blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.csdn.net/" title="https:&#x2F;&#x2F;www.csdn.net&#x2F;" rel="noopener" target="_blank">CSDN</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.google.com/" title="https:&#x2F;&#x2F;www.google.com" rel="noopener" target="_blank">Google</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        <!-- 访问量 -->

    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 


<!-- 版权 -->
<div class="copyright">
  
  &copy; 2021-12-1 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lrk612</span>
</div>

<!-- ICP备案 -->
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">ICP备案 </a>
      <img src="https://gitee.com/lrk612/md_picture/raw/master/img/20211209170739.png" style="display: inline-block;"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=2021035798" rel="noopener" target="_blank">豫ICP备2021035798号 </a>
  </div>

<!-- 不知道是什么 -->
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'fH6OdGBcCG8D6jC8NeeJlX9b-gzGzoHsz',
      appKey     : '1UoIb6vszMw6wl0n7kreb4Xz',
      placeholder: "Just go go ^_^",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
    var infoEle = document.querySelector('#comments .info');
    if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0){
      infoEle.childNodes.forEach(function(item) {
        item.parentNode.removeChild(item);
      });
    }
  }, window.Valine);
});
</script>

</body>
</html>
